<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Key Login Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: 'Inter', sans-serif; background: #f5f7fa; display:flex; justify-content:center; align-items:center; height:100vh; }
.card { background:#fff; padding:30px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); width:100%; max-width:400px; }
.form-group { margin-bottom:20px; }
.form-control { width:100%; padding:10px 15px; border:1px solid #ddd; border-radius:6px; font-size:14px; }
.btn-primary { background:#4361ee; color:#fff; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; width:100%; }
.form-result { margin-top:15px; padding:10px; border-radius:6px; text-align:center; }
.form-result.success { background: rgba(76,201,240,0.2); color: #4cc9f0; }
.form-result.error { background: rgba(247,37,133,0.2); color: #f72585; }
</style>
</head>
<body>

<div class="card">
  <h2 style="text-align:center; margin-bottom:20px;"><i class="fas fa-key"></i> Key Login Demo</h2>
  <div class="form-group">
    <input type="text" id="keyInput" class="form-control" placeholder="Enter your key">
  </div>
  <button id="loginBtn" class="btn-primary">Login</button>
  <div id="result" class="form-result"></div>
</div>

<script type="module">
  import { db } from "./firebase-config.js";
  import { ref, get } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

  const loginBtn = document.getElementById('loginBtn');
  const keyInput = document.getElementById('keyInput');
  const resultEl = document.getElementById('result');

  loginBtn.addEventListener('click', async () => {
    const key = keyInput.value.trim();
    if (!key) {
      showResult('Please enter a key', 'error');
      return;
    }

    try {
      const userRef = ref(db, `userinfo/${key}`);
      const snapshot = await get(userRef);

      if (!snapshot.exists()) {
        showResult('Invalid Key', 'error');
        return;
      }

      const userData = snapshot.val();
      const now = new Date();
      const [day, month, year, hour, minute] = userData.validity.match(/\d+/g);
      const validityDate = new Date(`${year}-${month}-${day}T${hour}:${minute}:00`);

      if (userData.status !== 'active') {
        showResult('This key is inactive', 'error');
        return;
      }

      if (now > validityDate) {
        showResult('Key has expired', 'error');
        return;
      }

      // Success
      showResult(`Login Successful! Welcome. Key: ${userData.key}`, 'success');

    } catch (err) {
      showResult('Error: ' + err.message, 'error');
    }
  });

  function showResult(msg, type) {
    resultEl.textContent = msg;
    resultEl.className = `form-result ${type}`;
    setTimeout(() => {
      resultEl.textContent = '';
      resultEl.className = 'form-result';
    }, 5000);
  }
</script>

</body>
</html>
